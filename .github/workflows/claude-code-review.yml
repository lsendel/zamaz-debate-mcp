name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - "mcp-*/src/**/*.java"
      - "debate-ui/src/**/*.{ts,tsx,js,jsx}"
      - "*.yml"
      - "*.yaml"
      - "pom.xml"

jobs:
  claude-review:
    name: AI Code Review
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    # Skip for draft PRs and WIP
    if: |
      !github.event.pull_request.draft &&
      !contains(github.event.pull_request.title, '[skip-review]') &&
      !contains(github.event.pull_request.title, '[WIP]')
    
    permissions:
      contents: read
      pull-requests: write
      issues: read
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
          
      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          model: "claude-3-5-sonnet-20241022"
          
          direct_prompt: |
            Review this pull request for the Zamaz Debate MCP Services project.
            
            Focus on:
            🔍 **Code Quality**: Best practices, maintainability, readability
            🐛 **Bug Prevention**: Logic errors, edge cases, null checks
            🚀 **Performance**: Efficiency, resource usage, scalability
            🔒 **Security**: Input validation, authentication, data exposure
            🧪 **Testing**: Coverage, test quality, missing tests
            ☕ **Java/Spring**: Proper annotations, dependency injection, exception handling
            ⚛️ **React/TypeScript**: Type safety, component design, hooks usage
            
            Be constructive and provide specific suggestions with code examples when helpful.

