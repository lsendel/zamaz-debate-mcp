<!DOCTYPE html>
<html>
<head>
    <title>Debug UI State</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .warning { background-color: #fff3cd; }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <h1>Debug UI State</h1>
    
    <div class="section">
        <h2>Quick Actions</h2>
        <button onclick="checkLocalStorage()">Check LocalStorage</button>
        <button onclick="resetOrganization()">Reset Organization</button>
        <button onclick="testAPIs()">Test APIs</button>
        <button onclick="checkConsole()">Check Console</button>
    </div>
    
    <div id="output" class="section">
        <h2>Output</h2>
        <pre id="outputContent">Click a button to see results...</pre>
    </div>
    
    <div class="section">
        <h2>Live App View</h2>
        <iframe id="appFrame" src="http://localhost:3001"></iframe>
    </div>
    
    <script>
        function output(content) {
            document.getElementById('outputContent').textContent = JSON.stringify(content, null, 2);
        }
        
        function checkLocalStorage() {
            const frame = document.getElementById('appFrame').contentWindow;
            try {
                const data = {
                    currentOrganizationId: frame.localStorage.getItem('currentOrganizationId'),
                    organizations: JSON.parse(frame.localStorage.getItem('organizations') || '[]'),
                    organizationHistory: JSON.parse(frame.localStorage.getItem('organizationHistory') || '[]')
                };
                output(data);
            } catch (e) {
                output({ error: 'Could not access localStorage: ' + e.message });
            }
        }
        
        function resetOrganization() {
            const frame = document.getElementById('appFrame').contentWindow;
            try {
                // Clear existing data
                frame.localStorage.removeItem('currentOrganizationId');
                frame.localStorage.removeItem('organizations');
                frame.localStorage.removeItem('organizationHistory');
                
                // Set default organization
                const defaultOrg = {
                    id: 'default-org',
                    name: 'Default Organization',
                    createdAt: new Date().toISOString(),
                    debateCount: 0
                };
                
                frame.localStorage.setItem('organizations', JSON.stringify([defaultOrg]));
                frame.localStorage.setItem('currentOrganizationId', defaultOrg.id);
                
                output({ 
                    message: 'Organization reset complete', 
                    organization: defaultOrg,
                    action: 'Reload the page to see changes'
                });
                
                // Reload iframe
                setTimeout(() => {
                    frame.location.reload();
                }, 1000);
            } catch (e) {
                output({ error: 'Could not reset organization: ' + e.message });
            }
        }
        
        async function testAPIs() {
            try {
                const results = {};
                
                // Test debate API
                const debateRes = await fetch('http://localhost:3001/api/debate/resources?uri=debate://debates');
                results.debateAPI = {
                    status: debateRes.status,
                    data: await debateRes.json()
                };
                
                // Test LLM API
                const llmRes = await fetch('http://localhost:3001/api/llm/providers');
                results.llmAPI = {
                    status: llmRes.status,
                    data: await llmRes.json()
                };
                
                // Test health API
                const healthRes = await fetch('http://localhost:3001/api/llm/health');
                results.healthAPI = {
                    status: healthRes.status,
                    data: await healthRes.json()
                };
                
                output(results);
            } catch (e) {
                output({ error: 'API test failed: ' + e.message });
            }
        }
        
        function checkConsole() {
            const frame = document.getElementById('appFrame').contentWindow;
            
            // Try to get React DevTools info
            try {
                const info = {
                    hasReactDevTools: !!frame.__REACT_DEVTOOLS_GLOBAL_HOOK__,
                    nextVersion: frame.__NEXT_DATA__?.version || 'Unknown',
                    pageProps: frame.__NEXT_DATA__?.props || {},
                    buildId: frame.__NEXT_DATA__?.buildId || 'Unknown'
                };
                output(info);
            } catch (e) {
                output({ error: 'Could not access app data: ' + e.message });
            }
        }
        
        // Auto-check APIs on load
        window.onload = () => {
            setTimeout(testAPIs, 2000);
        };
    </script>
</body>
</html>