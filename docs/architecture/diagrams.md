# Architecture Diagrams

This document contains architecture diagrams for the Zamaz Debate MCP system.

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           Client Applications                           │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                             MCP Gateway                                 │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Auth Filter │  │ Rate Limit  │  │ Routing     │  │ Monitoring  │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
└───────┬─────────────────┬─────────────────┬─────────────────┬───────────┘
        │                 │                 │                 │
        ▼                 ▼                 ▼                 ▼
┌───────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│               │  │             │  │             │  │             │
│ MCP-Security  │  │ MCP-Org     │  │ MCP-Context │  │ MCP-LLM     │
│               │  │             │  │             │  │             │
└───────┬───────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
        │                 │                │                │
        └─────────────────┼────────────────┼────────────────┘
                          │                │
                          ▼                ▼
                   ┌─────────────┐  ┌─────────────┐
                   │             │  │             │
                   │ MCP-        │  │ MCP-RAG     │
                   │ Controller  │  │             │
                   │             │  │             │
                   └──────┬──────┘  └──────┬──────┘
                          │                │
                          └────────┬───────┘
                                   │
                                   ▼
                          ┌─────────────────┐
                          │                 │
                          │ MCP-Template    │
                          │                 │
                          └─────────────────┘
```

## Service Dependencies

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  MCP-Gateway    │────▶│  MCP-Security   │◀────│  All Services   │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                        ▲                       ▲
        │                        │                       │
        ▼                        │                       │
┌─────────────────┐              │               ┌─────────────────┐
│                 │              │               │                 │
│  MCP-Common     │──────────────┴───────────────│  MCP-Context    │
│                 │                              │                 │
└─────────────────┘                              └─────────────────┘
        ▲                                                ▲
        │                                                │
        │                                                │
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  MCP-           │────▶│  MCP-LLM        │◀────│  MCP-RAG        │
│  Organization   │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        ▲                        ▲                       ▲
        │                        │                       │
        │                        │                       │
        │                ┌─────────────────┐             │
        │                │                 │             │
        └────────────────│  MCP-Controller │─────────────┘
                         │                 │
                         └────────┬────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │                 │
                         │  MCP-Template   │
                         │                 │
                         └─────────────────┘
```

## Data Flow

```
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                           Client Request                              │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                             MCP Gateway                               │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                           Authentication                              │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                           Authorization                               │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                         Service Processing                            │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                          Response Generation                          │
│                                                                       │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                                                                       │
│                           Client Response                             │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

## Multi-Tenant Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Organizations                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   │
│  │  Org A  │  │  Org B  │  │  Org C  │  │  Org D  │   │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘   │
└───────┼────────────┼────────────┼────────────┼─────────┘
        │            │            │            │
        └────────────┴────────────┴────────────┘
                           │
                     MCP Protocol
                           │
        ┌──────────────────┴───────────────────┐
        │                                      │
        ▼                                      ▼
┌───────────────┐                    ┌──────────────┐
│  MCP-         │                    │   MCP-RAG    │
│  Controller   │                    │              │
│               │                    │              │
└───────┬───────┘                    └──────┬───────┘
        │                                   │
        │         ┌─────────────┐           │
        └────────►│ MCP-Context │◄──────────┘
                  │             │
                  │             │
                  │             │
                  └──────┬──────┘
                         │
                         ▼
                  ┌─────────────┐
                  │   MCP-LLM   │
                  │             │
                  │             │
                  └─────────────┘
```

## Debate Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           Create Debate                                 │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         Configure Participants                          │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           Start Debate                                  │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
                          ┌─────────────────────┐
                          │                     │
                          │   Get Next Turn     │
                          │                     │
                          └──────────┬──────────┘
                                     │
                                     ▼
                          ┌─────────────────────┐
                          │                     │
                          │  Generate Response  │◄─────┐
                          │                     │      │
                          └──────────┬──────────┘      │
                                     │                 │
                                     ▼                 │
                          ┌─────────────────────┐      │
                          │                     │      │
                          │   Add to Context    │      │
                          │                     │      │
                          └──────────┬──────────┘      │
                                     │                 │
                                     ▼                 │
                          ┌─────────────────────┐      │
                          │                     │      │
                          │  More Turns Left?   │──Yes─┘
                          │                     │
                          └──────────┬──────────┘
                                     │
                                     │ No
                                     ▼
                          ┌─────────────────────┐
                          │                     │
                          │  Generate Summary   │
                          │                     │
                          └─────────────────────┘
```

## LLM Integration

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           MCP-Controller                                │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                             MCP-Context                                 │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                              MCP-LLM                                    │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Claude      │  │ OpenAI      │  │ Gemini      │  │ Llama       │     │
│  │ Provider    │  │ Provider    │  │ Provider    │  │ Provider    │     │
│  └─────┬───────┘  └─────┬───────┘  └─────┬───────┘  └─────┬───────┘     │
│        │                │                │                │             │
└────────┼────────────────┼────────────────┼────────────────┼─────────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│                 │ │                 │ │                 │ │                 │
│ Anthropic API   │ │ OpenAI API      │ │ Google AI API   │ │ Ollama API      │
│                 │ │                 │ │                 │ │                 │
└─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────────┘
```

## RAG Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                             MCP-RAG                                     │
│                                                                         │
│  ┌─────────────────────┐   ┌─────────────────────┐                      │
│  │                     │   │                     │                      │
│  │  Document Ingestion │──▶│  Document Chunking  │                      │
│  │                     │   │                     │                      │
│  └─────────────────────┘   └──────────┬──────────┘                      │
│                                       │                                 │
│                                       ▼                                 │
│                            ┌─────────────────────┐                      │
│                            │                     │                      │
│                            │ Embedding Generation│                      │
│                            │                     │                      │
│                            └──────────┬──────────┘                      │
│                                       │                                 │
│  ┌─────────────────────┐              │                                 │
│  │                     │              ▼                                 │
│  │   Query Processing  │   ┌─────────────────────┐                      │
│  │                     │   │                     │                      │
│  └──────────┬──────────┘   │   Vector Storage    │                      │
│             │              │                     │                      │
│             │              └──────────┬──────────┘                      │
│             │                         │                                 │
│             ▼                         ▼                                 │
│  ┌─────────────────────┐   ┌─────────────────────┐                      │
│  │                     │   │                     │                      │
│  │ Embedding Generation│──▶│   Vector Search     │                      │
│  │                     │   │                     │                      │
│  └─────────────────────┘   └──────────┬──────────┘                      │
│                                       │                                 │
│                                       ▼                                 │
│                            ┌─────────────────────┐                      │
│                            │                     │                      │
│                            │ Context Augmentation│                      │
│                            │                     │                      │
│                            └─────────────────────┘                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           Docker Compose                                │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ MCP Gateway │  │ MCP Security│  │ MCP Org     │  │ MCP Context │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ MCP LLM     │  │ MCP         │  │ MCP RAG     │  │ MCP Template│     │
│  │             │  │ Controller  │  │             │  │             │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ PostgreSQL  │  │ Redis       │  │ Qdrant      │  │ Ollama      │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐                                       │
│  │ Prometheus  │  │ Grafana     │                                       │
│  └─────────────┘  └─────────────┘                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
